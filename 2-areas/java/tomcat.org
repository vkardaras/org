#+title: Tomcat

* Installation

Download from https://tomcat.apache.org/ and unzip the file

* Create a account

#+begin_src sh
# add a system account
useradd -r tomcat

# change permissions of tomcat account to user created
chown -R tomcat:tomcat /usr/local/tomcat10
#+end_src

* Create a system service

** Create the file for the service

#+begin_src sh
vim /etc/systemd/system/tomcat.service
#+end_src

** The contents of the service

#+begin_src conf
[Unit]
Description=Apache tomcat
After=syslog.target network.target

[Service]
Type=forking
User=tomcat
Group=tomcat

Environment=CATALINA_PID=/user/local/tomcat10/temp/tomcat.pid
Environment=CATALINA_HOME=/user/local/tomcat10
Environment=CATALINA_BASE=/user/local/tomcat10

ExecStart=/usr/local/tomcat10/bit/catalina.sh start
ExecStop=/usr/local/tomcat10/bit/catalina.sh stop

RestartSec=12
Restart=always

[Install]
WantedBy=multi-user.target
#+end_src

** Reload the daemon systemctl

#+begin_src sh
systemctl daemon-reload
#+end_src

** Start the service

#+begin_src sh
systemctl start tomcat.service
#+end_src

* Run tomcat

Move to the bin directory

#+begin_src sh
# start tomcat
./catalina.sh run

# start as a background daemon
./startup.sh
#+end_src

Visit tomcat at http://localhost:8080

* Add user

Edit the file =conf/tomcat-users.xml=

#+begin_src xml
<tomcat-users ...>
  ...
  <role rolename="admin-gui,manager-gui"/>
  <user username="admin" password="pEnguinLA@45" roles="admin-gui,admin-script,manager-gui"/>
</tomcat-users>
#+end_src

* Allow access remotely from an external site

Edit the file =webapps/manager/META-INF/context.xml=

#+begin_src xml
<!-- allow access from a specific external IP address e.g. 203.0.113.10 -->
<Valve className="org.apache.catalina.valves.RemoteCIDRValve"
       allow="203.0.113.10" />

<!-- allow access from an entire subnet, such as 203.0.113.0/24 -->
<Valve className="org.apache.catalina.valves.RemoteCIDRValve"
       allow="203.0.113.0/24" />

<!-- allow access from everywhere -->
<Valve className="org.apache.catalina.valves.RemoteCIDRValve"
       allow=".*" />
#+end_src

* Access the server from command line

#+begin_src sh
curl -u admin:pEnguinLA@45 http://localhost:8080/host-manager/text/list
#+end_src
